/********************************Copyright (c)**********************************
**
**                   (c) Copyright 2019, Main, China, QD.
**                           All Rights Reserved
**
**                      		 XXXXXXXXX有限公司
**                           
**
**----------------------------------文件信息------------------------------------
** 文件名称: bsp_timer.c
** 创建人员: Andy
** 创建日期: 2020/04/28 15:40
** 文档描述: 定时器模块
**
**----------------------------------版本信息------------------------------------
** 版本代号: V0.0.0.1
** 版本说明: 初始版本
**
**------------------------------------------------------------------------------
*/
#include "drv_timer.h"

/* define variables */
STATIC uint8_t Timer_Sta; 		// 1S状态，用于显示
STATIC uint32_t count;        	// times counter sta

/*******************************************************************************
** 功能描述: 定时器中断
** 参数说明: 无
** 返回说明: 无
** 创建人员: Andy
** 创建日期: 2021/4/03 14:45
**------------------------------------------------------------------------------
** 修改人员: wxd
** 修改日期: 2021/4/03
** 修改描述: 
**------------------------------------------------------------------------------
********************************************************************************/
void tm0_isr() interrupt 1
{	
	
	TL0 = T1MS;                     // reload timer0 low byte
	TH0 = T1MS >> 8;                // reload timer0 high byte
	
	if (count-- == 0)               // 1ms * 1000 -> 1s
	{
		count = 1000;                // reset counter
		Timer_Sta = 1;        	  // work LED flash
	}
	
	return;
}

/*******************************************************************************
** 功能描述: 获取定时器1S状态
** 参数说明: 无
** 返回说明: 1：定时时间到
** 创建人员: Andy
** 创建日期: 2021/4/03 14:45
**------------------------------------------------------------------------------
** 修改人员: wxd
** 修改日期: 2021/4/03
** 修改描述: 
**------------------------------------------------------------------------------
********************************************************************************/
uint8_t bsp_get_time_1s_sta(void)
{
	uint8_t ret = Timer_Sta;
	
	Timer_Sta = 0;
	
	return ret;
}

/*******************************************************************************
** 功能描述: 设置定时器1S状态
** 参数说明: 无
** 返回说明: 无
** 创建人员: Andy
** 创建日期: 2021/4/03 14:45
**------------------------------------------------------------------------------
** 修改人员: wxd
** 修改日期: 2021/4/03
** 修改描述: 
**------------------------------------------------------------------------------
********************************************************************************/
void bsp_start_time(void)
{
	TMOD = 0x01;                    // set timer0 as mode1 (16-bit)
	TL0 = T1MS;                     // initial timer0 low byte
	TH0 = T1MS >> 8;                // initial timer0 high byte
	TR0 = 1;                        // timer0 stop running
	ET0 = 1;                        // enable timer0 interrupt
	EA  = 1;                        // clos global interrupt switch
	
	/* 参数清空 */
	count = 0;  
	Timer_Sta = 0;
	
	return;
}
/*-----------------By_Andy_2020/4/28 15:35------------------*/
/*-----------------------------------------------------------------------------------------*/
